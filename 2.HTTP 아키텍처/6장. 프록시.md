## 06. 프록시  
  프록시는 클라이언트와 서버 사이에 위치하여 그들 사이의 HTTP메세지를 정리하는 중개인처럼 동작한다.
### 6.1 웹 중개자
  - 웹 프록시 서버는 클라이언트이 입장에서 트랜잭션을 수행하는 중개인이다.
### 6.1.1 개인 프록시와 공유 프록시
  - 개인 프록시 : 클라이언트 컴퓨터에서 직접 실행되는 형태의 프록시 
  - 공유 프록시 : 대부분의 프록시는 공용이며 공유되는 프록시 ( 중앙 집중형 프록시를 관리하는게 비용효율이 높고 쉽다. )
### 6.1.2 프록시 대 게이트웨이
  - 프록시 : 같은 프로토콜을 사용하는 둘 이상의 애플리케이션을 연결
  - 게이트웨이 : 서로 다른 프로토콜을 사용하는 둘 이상을 연결
### 6.2 왜 프록시를 사용하는가?
  - 보안을 개선하고, 성능을 높여주며, 비용을 절약한다. 또한 모든 HTTP 트래픽을 볼 수 있어서 감시하고 수정이 가능하다.
  - ex)
    - 어린이 필터 : 성인 코텐츠를 차단함
    - 문서 접근 제어자 : 많은 웹 서버들과 웹 리소스에 대한 단일한 접근 제어 전략을 구현하고 감사추적을 하기 위해 사용될 수 있다.(다른 웹 서버에 접근 제어)
    - 보안 방화벽 : 프록시 서버는 조직 안에 들어오거나 나가는 응용 레벨 프로토콜의 흐름을 네트워크의 한 지점에서 통제한다.
    - 웹 캐시 : 인기 있는 문서의 로컬 사본을 관리하고 해당 문서에 대한 요청이 오면 빠르게 제공하여, 느리고 비싼 인터넷 커뮤니케이션을 줄인다.
    - 대리 프록시 : 웹 서버 요청을 받지만 웹 서버와는 달리 요청 받는 콘텐츠의 위치를 찾아내기 위해 다른 서버와 커뮤니케이션을 시작한다.(리버스 프록시 또는 서버 가속기라고 불린다.)
    - 콘텐츠 라우터 : 프록시 서버는 인터넷 트래픽 조건과 콘텐츠의 종류에 따라 요청을 특정 웹 서버로 유도하는 콘텐츠 라우터로 동작할 수 있다.
    - 트랜스코더 : 프록시 서버는 콘텐츠를 클라이언트에게 전달하기 전에 본문 포맷을 수정할 수 있다.
    - 익명화 프록시 : HTTP 메세지에서 신원을 식별할 수 있는 특성들을 적극적으로 제거함으로써 개인정보 보호와 익명성 보장에 기여한다.
### 6.3 프록시는 어디에 있는가?  
### 6.3.1 프록시 서버 배치
  - 어떻게 사용할지에 따라서 프록시는 어디에든 배치할 수 있다.
  - ex)
    - 출구(Egress) 프록시 : 로컬 네트워크와 더 큰 인터넷 사이를 오가는 트래픽을 제어하기 위해 프록시를 `로컬 네트워크의 출구`에 배치할 수 있다.
    - 접근(입구) 프록시 : 프록시는 `ISP 접근지점`에 위치하기도 한다.
    - 대리 프록시 : 네트워크의 가장 끝에 있는 `웹 서버들의 바로 앞`에 위치하여 웹 서버로 향하는 모든 요청을 처리하고 필요할 때만 자원을 요청할 수 있다. 
    - 네트워크 교환 프록시 : 트래픽 흐름을 감시하기 위해 `네트워크 사이의 인터넷 피어링 교환 지점`들에 놓일 수 있다.
### 6.3.2 프록시 계층
  - 프록시 계층에서 프록시 서버들은 부모와 자식의 관계를 갖는다.
  - 서버에 가까운 쪽을 부모(인바운드), 클라이언트에 가까운 쪽을 자식(아웃바운드)
  - 프록시 계층 콘텐츠 라우팅 : 프록시 서버는 여러가지 판단 근거에 의해 메세지를 다양하고 유동적인 프록시 서버와 원 서버들의 집합에게 보낼 수 있다.
  - 동적 부모 선택 ex)
    - 부하 균형 : 자식 프록시는 부하를 분산하기 위해 현재 부모들의 작업량 수준에 근거하여 부모 프록시를 고른다.
    - 지리적 인접성에 근거한 라우팅 : 자식 프록시는 원 서버의 지역을 담당하는 부모를 선택할 수 있다.
    - 프로토콜/타입 라우팅 : 프록시는 URI에 근거하여 다른 부모나 원 서버로 라우팅 할 수 있다.
    - 유료 서비스 가입자를 위한 라우팅 : 대형 캐시나 성능 개선을 위한 압축 엔진으로 라우팅 될 수 있다.
### 6.3.3 어떻게 프록시가 트래픽을 처리하는가
  - 클라이언트를 수정한다.
  - 네트워크를 수정한다. 
  - DNS 이름 공간을 수정한다.
  - 웹 서버를 수정한다.
### 6.4 클라이언트 프록시 설정
  - 수동 설정: 프록시 사용을 명시적으로 설정
  - 브라우저 기본 설정 : 브라우저 벤더나 배포자는 소비자에게 전달하기 전에 프록시를 미리 설정해 놓을 수 있다.
  - 프록시 자동 설정 : 자바스크립트 프록시 자동 설정(PAC)파일에 대한 URI를 제공할 수 있다.
  - WPAD 프록시 발견
### 6.4.1 클라이언트 프록시 설정: 수동
  - 많은 웹 클라이언트가 프록시를 수동으로 설정할 수 있도록 한다.
### 6.4.2 클라이언트 프록시 설정: PAC 파일
  - 수동 프록시 설정은 단순하지만 반면에 유연하지 못하다. 그래서 PAC은 동적으로 프록시 설정을 그때그때 상황에 맞게 프록시 서버를 선택해야한다.
### 6.4.3 클라이언트 프록시 설정: WPAD
  - WPAD는 여러 발견 메커니즘들의 상승 전략을 이용해 브라우저에 알맞은 PAC 파일을 자동으로 찾아주는 알고리즘이다.
### 6.5 프록시 요청의 미묘한 특징
### 6.5.1 프록시 URI는 서버 URI와 다르다
  - 요청 URI는 클라이언트가 `웹 서버`/`프록시`로 요청을 보낼때 다르다.
  - 웹 서버 : GET `/index.html`
  - 프록시 : GET `http://www.example.com/index.html`
  - 서버와 프록시에 각각 다른 요청 형식이 다른가 
    - 서버는 HTTP 설계될 당시 단일 서버는 자신의 호스트명과 포트번호를 알고 있기때문에 클라이언트는 불필요한 정보 발송이 피하기 위해 `부분 URI`를 보내게 되었다.
    - 프록시는 목적지인 서버의 이름을 알 필요가 있기 때문에 `완전한 URI`를 보내게 되었다.
### 6.5.2 가상 호스팅에서 일어나는 같은 문제
  - '스킴/호스트/포트번호' 누락 문제의 경우
  - 명시적 프록시는 `요청 메세지`에 완전한 URI를 갖도록 해서 해결한다.
  - 가상으로 호스팅 되는 웹 서버는 `Host 헤더`에 호스트와 포트에 대한 정보를 담게해서 해결한다.
### 6.5.3 인터셉트 프록시는 부분 URI를 받는다.
  - 클라이언트에서 서버로 가는 트래픽을 가로채 캐시된 응답을 돌려주는 등의 일을 하는 프록시 서버이다.
  - 클라이언트에서 서버로 가는 트래픽을 가로채기 때문에 웹 서버로 보내는 부분 URI를 얻게 된다.
### 6.5.4 프록시는 프록시 요청과 서버 요청을 모두 다룰 수 있다.
  - 다목적 프록시 서버는 요청 메세지의 완전한 URI와 부분 URI를 모두 지원해야한다.
### 6.5.5 전송중 URI 변경
  - 프록시 서버는 요청 URI를 서버로 보내줄때 URI를 변경해야하는 경우가 있기때문에 주의해야한다.
### 6.5.6 URI 클라이언트 자동확장과 호스트 명 분석
  - 많은 브라우저들은 사용자가 호스트명의 짧은 약어를 타이핑한 것으로 보고 자동화된 호스트 명의 확장을 제공한다.(이는 `확장 URL`과 비슷하다)
### 6.5.7 프록시 없는 URI 분석
  - 브라우저는 유효한 호스트 명이 발견될 때까지 다양한 호스트 명의 가능성을 검색하여 연결하는데 성공한다.
